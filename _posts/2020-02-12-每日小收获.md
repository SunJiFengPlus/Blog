---
layout:     post
title:      每日小收获
subtitle:   
date:       2020-02-12
author:     孙继峰
header-img: img/th.jpg
catalog: true
tags:
---

- #### 重基础, 轻框架<br>

- 自定义 Validator 抛的异常是 BindException, 而 Spring 自带 Validator 抛的是 MethodParamNotValidException. 这就有点坑了, 一个是 is a 的关系 一个是 has a 的关系, 不方便聚合下沉.<br>

- #### ⚠️ UPDATE 语句千万不要忘记写 WHERE 条件<br>

- 微服务开发完成后, 出一个 jar 包, 包含着服务调用相关的领域模型, 由调用方引入<br>

- 方法名、变量名不要起无意义的名字, 如 handle、data、result 等, 整个项目都是在处理数据, 每个方法的返回值都是result<br>

- #### 时间戳替换TimeStamp<br>

- #### 使用云资源的时候不要轻易压测<br>

- #### 完美的 lambda 表达式只有一行<br>

- #### 流处理不要过于复杂, 否则很难维护<br>
```java
class Example {
    public void test() {
        Stream<Tuple2<Integer, Integer>> tagIdChannel = tagIdChannelList.stream()
            .flatMap(GoodsInfoDO::getTagIdAndChannelStream);
        Map<Integer, Map<Integer, Long>> tagIdCount = tagIdChannel.collect(Collectors
            .groupingBy(Tuple2::getT1, Collectors.groupingBy(Tuple2::getT2, Collectors.counting())));
    }
}
```
<br><br>
- Redis 的不要求时效性的大任务要拆分成小任务执行, 已留给其他连接一些资源<br>

- 水平扩展: 加机器；垂直扩展: 换更好的CPU, 加内存, 加硬盘<br>

- 技术驱动业务: 技术给产品开会；业务驱动技术: 产品给技术开会<br>

- 多线程下 高内聚低耦合, 线程操作资源类, 判断干活唤醒通知, 防止虚假唤醒<br>

- 阶段性推送, 一阶段少量推送, 预热缓存, 二阶段剩余全部推送<br>

> 当项目负责人的时候需要随时带电脑, 手机不要静音, 微信, 钉钉, 保证能联系到<br>

- ```Guava Lists.partition(gidList, 10);``` 对集合进行拆分<br>

> - 没有测试，没有行为保持的手法，没有小步前进，要啥啥没有，你跟我扯啥重构
> - 刀砍斧劈地修改代码，不叫重构
> - 重构 = 质量保障 + 配置管理 + 项目管理 + 需求管理
> - 过于细致的分工是将工人螺丝钉化<br>

- 默认的传播行为: REQUIERP, 同一个类下没有 @Transactional 注解的方法调用有 @Transactional 注解的方法时无效; 不同类下有效<br>

> 我还记得new grad的时候进公司不久问了老板一个问题：'我们每次deploy时，service就down了，我们岂不是会丢掉很多requests?' 我当时的老板一口茶差点没喷出来。
后来我才知道原来changes可以分步deploy到hosts上。具体步骤分为3步：
> 1. 在deployment前从VIP/Load balancer/DNS disable该host；
> 2. Deployment。host运行app版本被更新为最新版；
> 3. 在deployment完成后再把host加回VIP/Load balancer/DNS。<br>

- #### SOLID原则 尤其是单一职责原则, 把它做好了才能舒服的 TDD<br>

- IO密集型任务应该多分配一些线程；CPU 密集型任务应该少分配一些线程<br>

> 如果你们手头已经有排期的工作受到影响，一定要提前沟通<br>

> HTTP 是人与机器交互的协议, RSocket 是机器与机器交互的协议

> 任何项目上线  都要在上线文档中 标明pull代码的具体时间

#### 提交前准备工作:
- 执行 IDEA 插件 FindBug 进行静态检查
- 执行全部测试用例, 并检查语句顿号覆盖<br><br>

- #### 流程确认到流程图再开始写代码

- #### 很多领域的边界就是流程的边界
- #### 微服务拆分中如果没有CICD和自动化的运维能力，不建议拆的过细。
- #### 数据库只是领域模型的持久化存储方式
- #### 一个限界上下文理论上就可以设计为一个微服务
- #### 与实体相关的所有业务逻辑都在实体类的方法中实现，跨多个实体的领域逻辑则在领域服务中实现。

- ##### 与其让用户阻塞等待成功, 不如让用户多请求几次

- ##### 只有在知道外部依赖可能返回什么的时候才能进行Mock

- ##### 面试过程中没有思路，可以向面试官寻求一些提示

- ##### 优秀地测试用例可以当做文档来阅读

- ##### @DisplayName("测试用例展示名称")

- ##### RedissonClient 与 RedisTemplate 不兼容

> 阿里巴巴JAVA开发手册提倡的理念是宁可抛错，绝不错写数据。

- 代码优化要和开发用不同的 branch

- 报告bug时应该准备好受影响范围、影响时间、如何修复
- 上线前准备bug信息收集的脚本、修复数据的脚本

- ```Iterables.getOnlyElement(anyList());```获取集合中第一个元素, 如果还有第二个元素则抛异常

经理说我的数据敏感度不够, 确实是我对公司的业务还是不太熟悉(有待加强)<br> 
再有一个针对业务写的代码很死, 不易修改, 项目的需求不稳定的阶段就把代码写死真的是一个很大的痛点.<br>

> 为一个延误的IT项目增加人员, 将导致更严重的延误.

- 我的理解需求能力弱, 以前都是一点一点的需求, 还处理的过滤, 现在是一堆需求就处理不过来了, 甚至已经完成开发的接口内部逻辑还不太清晰

- 通过这次开发感觉到```现场客户```的实践可以解决部分问题, 就让产品坐在开发人员旁边, 
而当前的情况是产品和开发在不同的屋子内, 而且还有远程办公的

> 一切技术不足管理补的所谓「规模化敏捷」都是扯淡。
> 任何「规模化敏捷」、乃至任何「敏捷」的办法，必须基于极限编程的工程技术实践：
> 测试驱动开发，持续集成，重构。脱离这些工程技术实践的「敏捷」，统统是伪敏捷。

- MyBatis-Plus 的 updateBatch 入参要校验是否为空集合, 在这上面栽好几次跟头了
- ⚠️ MyBatis-Plus 的 in 条件一定要判空