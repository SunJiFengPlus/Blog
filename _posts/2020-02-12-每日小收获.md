---
layout:     post
title:      琐碎小收获
subtitle:   
date:       2020-02-12
author:     孙继峰
header-img: img/th.jpg
catalog: true
tags:
---

- #### 重基础, 轻框架<br>

- 自定义 Validator 抛的异常是 BindException, 而 Spring 自带 Validator 抛的是 MethodParamNotValidException. 这就有点坑了, 一个是 is a 的关系 一个是 has a 的关系, 不方便聚合下沉.<br>

- #### ⚠️ UPDATE 语句千万不要忘记写 WHERE 条件<br>

- 微服务开发完成后, 出一个 jar 包, 包含着服务调用相关的领域模型, 由调用方引入<br>

- 方法名、变量名不要起无意义的名字, 如 handle、data、result 等, 整个项目都是在处理数据, 每个方法的返回值都是result<br>

- #### 时间戳替换TimeStamp<br>

- #### 使用云资源的时候不要轻易压测<br>

- #### 完美的 lambda 表达式只有一行<br>

- #### 流处理不要过于复杂, 否则很难维护<br>
```java
Stream<Tuple2<Integer, Integer>> tagIdChannel = tagIdChannelList.stream()
    .flatMap(GoodsInfoDO::getTagIdAndChannelStream);
Map<Integer, Map<Integer, Long>> tagIdCount = tagIdChannel.collect(Collectors
    .groupingBy(Tuple2::getT1, Collectors.groupingBy(Tuple2::getT2, Collectors.counting())));
```
<br><br>
- Redis 的不要求时效性的大任务要拆分成小任务执行, 已留给其他连接一些资源<br>

- 水平扩展: 加机器；垂直扩展: 换更好的CPU, 加内存, 加硬盘<br>

- 技术驱动业务: 技术给产品开会；业务驱动技术: 产品给技术开会<br>

- 多线程下 高内聚低耦合, 线程操作资源类, 判断干活唤醒通知, 防止虚假唤醒<br>

- 阶段性推送, 一阶段少量推送, 预热缓存, 二阶段剩余全部推送<br>

> 当项目负责人的时候需要随时带电脑, 手机不要静音, 微信, 钉钉, 保证能联系到<br>

- ```Guava Lists.partition(gidList, 10);``` 对集合进行拆分<br>

> - 没有测试，没有行为保持的手法，没有小步前进，要啥啥没有，你跟我扯啥重构
> - 刀砍斧劈地修改代码，不叫重构
> - 重构 = 质量保障 + 配置管理 + 项目管理 + 需求管理
> - 过于细致的分工是将工人螺丝钉化<br>

- 默认的传播行为: REQUIERP, 同一个类下没有 @Transactional 注解的方法调用有 @Transactional 注解的方法时无效; 不同类下有效<br>

> 我还记得new grad的时候进公司不久问了老板一个问题：'我们每次deploy时，service就down了，我们岂不是会丢掉很多requests?' 我当时的老板一口茶差点没喷出来。
后来我才知道原来changes可以分步deploy到hosts上。具体步骤分为3步：
> 1. 在deployment前从VIP/Load balancer/DNS disable该host；
> 2. Deployment。host运行app版本被更新为最新版；
> 3. 在deployment完成后再把host加回VIP/Load balancer/DNS。<br>

- #### SOLID原则 尤其是单一职责原则, 把它做好了才能舒服的 TDD<br>

- IO密集型任务应该多分配一些线程；CPU 密集型任务应该少分配一些线程<br>

> 如果你们手头已经有排期的工作受到影响，一定要提前沟通<br>

> HTTP 是人与机器交互的协议, RSocket 是机器与机器交互的协议