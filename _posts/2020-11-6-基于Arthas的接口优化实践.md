---
layout:     post
title:      基于Arthas的接口优化实践
subtitle:   
date:       2020-11-6
author:     孙继峰
header-img: img/th.jpg
catalog: true
tags:
	- 优化
---

#### 背景
近期线上接口频繁超时, 通过日志收集工具发现, 在请求量没有大幅增加时这个接口频繁超时.

#### 定位问题
我首先去确认了这些请求的请求内容是不是特别大.

![](https://i.loli.net/2020/11/09/k2mo4OBTXC3nUpA.png)
果然好家伙一次请求了1000多个资源, 这不慢才怪.
但是即使是请求了这么多资源也是业务的正常需求, 需要支持! 咋办? 优化呗!


#### 使用Arthas定位耗时节点
其实我很希望能在线上环境运行Arthas, 但是由于权限不足, 申请还挺麻烦, 
即是能在线上机器上运行Arthas, 我也会慌得一批, 生怕影响到应用. 所以还是选择了在测试环境操作.


启动Arthas, attach 上测试应用, 执行下面的命令
```shell script
 trace -n 3 -E com.ofashion.service.goodscenter.service.goods.impl.GoodsServiceImpl getGoodsInfoList '#cost>2000'
```
命令的作用是: 当 getGoodsInfoList 这个方法执行时长超过2000毫秒时则输出耗时记录, 输出3次后进行tear down

另外一边启动JMeter, 并发的请求大量资源.