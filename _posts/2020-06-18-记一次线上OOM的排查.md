---
layout:     post
title:      记一次线上OOM的排查
subtitle:   
date:       2020-05-30
author:     孙继峰
header-img: img/th2.jpg
catalog: true
tags:
    - OOM
---



> 接到上游系统报警, 商品服务不可用了.

---



#### 为什么服务不可用

通过日志排查发现应用抛OOM异常了, 到监控页面进一步确认后证实确实是抛OOM了

线上一共有两台机器, 一台机器OOM了, 一台机器内存完全正常

为了不影响上游服务, 组长重启的OOM的那台机器



#### 为什么OOM

通过日志聚合并没有发现在某个时间段有大量请求

希望能从dump文件中看看有什么问题, 于是开始下载dump文件

由于线上机器的外网带宽很低, 下载也就90k/s, 整个dump文件300M, 下载完成很长时间, 会极大影响排查效率

通知运维人员从内网去下载dump文件, 结果也消耗了2-3个小时才拿到了 dump 文件



使用 JProfile 打开dump文件

![JProfile](https://raw.githubusercontent.com/SunJiFengPlus/SunJiFengPlus.github.io/master/img/oom/JProfile1.png)

可以直接发现```GoodsInfoDO``` 这个对象占用了2个G的内层, 这并不正常



