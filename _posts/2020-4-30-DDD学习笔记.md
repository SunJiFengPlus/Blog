---
layout:     post
title:      DDD学习笔记
subtitle:   
date:       2020-04-07
author:     孙继峰
header-img: img/57af5e53909071.5945fd6963294.jpg
catalog: true
tags:
    - DDD
---
近期在学习 DDD 相关知识, 笔记还不够完善, 待我系统的学习完成后再根据我的理解进行整理.

### WHAT
> DDD 是一种处理高度复杂领域的设计思想，它试图分离技术实现的复杂性，并围绕业务概
念构建领域模型来控制业务的复杂性，以解决软件难以理解，难以演进的问题。DDD 不是
架构，而是一种架构设计方法论，它通过边界划分将复杂业务领域简单化，帮我们设计出清
晰的领域和应用边界，可以很容易地实现架构演进。

注: 虽然是汉语, 但是我看不懂

---
### WHY
从我刚开始实习的时候就听到过各种DDD相关的知识, 我个人认为是微服务的基础.

---
### DDD 和微服务的关注点
- DDD 主要关注：从业务领域视角划分领域边界，构建通用语言进行高效沟通，通过业务抽
象，建立领域模型，维持业务和代码的逻辑一致性。
- 微服务主要关注：运行时的进程间通信、容错和故障隔离，实现去中心化数据管理和去中心
化服务治理，关注微服务的独立开发、测试、构建和部署。

---
### 名词解释
#### 领域
要拥有自己的知识体系, 强调范围的, 如电商。

#### 子域
领域可以进一步拆分为子领域。把拆分出来的多个子领域称为子域，
每个子域对应一个更小的问题域或范围。
如商品子域、订单子域、商家子域、用户子域等。

#### 核心域
决定产品和公司核心竞争力的子域是核心域。如商品子域。

#### 通用域
同时被多个子域使用的子域是通用域。如鉴权验证子域。

#### 支撑域
既不包含决定产品和公司核心竞争力的功能，也不包含通用功能的子域。
如商品推荐子域。

#### 通用语言
通用语言是团队统一的语言，不管你在团队中承担什么角色，
在同一个领域的软件生命周期里都使用统一的语言进行交流。
例如在领域专家那里叫```上架```, 在开发人员这里叫```更新商品状态```, 
这种情况就是通用语言不一致。

#### 限界上下文
"能穿多少就穿多少" 在不同室外温度下会有不同的语义, 限界上下文就是用来确定语义所在的边界。

#### 实体: 
一系列属性的集合, 大多数情况与数据库表是一对一的关系, 有自己的唯一标识, 例如:
```java
public class Person {
    int id;
    int age;
    String name;
    Address address;
}
```

#### 值对象:
一系列属性的集合, 需要依附于实体存在, 例如:
```java
public class Address {
    String province;
    String city;
}
```
原则上是不可以修改的, 只能使用另一个对象去替换<br>
```person.address.city = "北京"``` × <br>
```person.address = new Address("北京", "北京")``` √

##### 值对象嵌入实体方式
- 属性嵌入: ```Person@{id=1, age=10, name="吴", province="北京", city="北京"}```
- 序列化嵌入: ```Person@{id=1, age=10, name="吴", address="{"province":"北京", "city":"北京"}"}```
address 的值是 Json 序列化后的 String 

##### 持久化方式
根据业务不同可以选择以下两种持久化方式

##### 范式持久化
person 一张表, address 一张表, address 表中有一个 person_id 的属性关联 person.id, <br>
这种方式保留了业务含义, 但是增加了数据库复杂度.

##### 反范式持久化
全部 address 属性都加到 person 表中, 可以field嵌入, 也可以序列化之后嵌入.<br>
这种方式破坏了业务含义, 但是没有增加数据库复杂度.

#### 聚合
领域模型中的实体和值对象就好比个体，而能让实体和值对象协同工作的组织就是聚合<br>
个人理解比较像是项目中使用的 ```XXService```, 这里理解的不是很清晰, Mark下

#### 聚合根
聚合根是一种特殊的实体, 可以理解为聚合根是聚合内实体与值对象的管理者

#### 领域事件
一个领域事件将导致进一步的业务操作, 例如: 密码连续输入错误三次,导致锁定账户的操作<br>
记得有次DDD分享时分享人说过, 领域事件就是该存到数据库中的事件<br>
领域事件的发布通常使用MQ进行发布, 通知订阅者处理领域事件<br>

---

### 事件风暴
#### 1. 确认需求愿景
用户故事: As a (Role), i want (Activity), so that (Business Value).
在完成用户故事确认之后会留下有效的用户故事, 以有效的用户故事来确定通用语言.

#### 2. 